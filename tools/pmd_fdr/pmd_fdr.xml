<tool id="pmd_fdr" name="PMD FDR" version="0.1.0">
    <description>recalculate FDR fom precursor mass discrepancy</description>
    <requirements>
        <requirement type="package" version="3.5.1">r-base</requirement>
        <requirement type="package" version="1.4.0">r-stringr</requirement>
        <requirement type="package" version="0.4">r-argparser</requirement>
        <requirement type="package" version="0.2-16">r-codetools</requirement>
        <requirement type="package" version="0.4.32">r-runit</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        Rscript '${__tool_directory__}/PMD_FDR_package_for_Galaxy.R' 
        --psm_report '$psm_report'
        #if $psm_report_1_percent:
          --psm_report_1_percent '$psm_report_1_percent'
        #end if
        --input_file_type $input_file_type 
        --output_g_fdr '$output_g_fdr'
        --output_i_fdr '$output_i_fdr'
        --output_densities '$output_densities'
    ]]></command>
    <inputs>
        <param argument="--psm_report" type="data" format="tabular" label="PSM report (Peptide Spectrum Match)"/>
        <param argument="--psm_report_1_percent" type="data" format="tabular" label="PSM report at 1% FDR (Optional)" optional="true"/>
        <param argument="--input_file_type" type="select" label="Input file type">
            <option value="PSM_Report" selected="true">PeptideShaker PSM_Report</option>
            <option value="PMD_FDR_input_file">PMD_FDR_input_file</option>
        </param>
    </inputs>
    <outputs>
        <data name="output_g_fdr" format="tabular" label="${tool.name} on ${on_string} output_g_fdr"/>
        <data name="output_i_fdr" format="tabular" label="${tool.name} on ${on_string} output_i_fdr"/>
        <data name="output_densities" format="tabular" label="${tool.name} on ${on_string} output_densities"/>
    </outputs>
    <tests>
        <test>
            <param name="psm_report" ftype="tabular" value="test_PSM_Report.tabular"/>
            <output name="output_g_fdr" file="output_g_fdr.tabular" />
            <output name="output_i_fdr" file="output_i_fdr.tabular" />
            <output name="output_densities" file="output_densities.tabular" />
        </test>
    </tests>
    <help><![CDATA[
Computes individual and global False Discovery Rate (FDR) using Precursor Mass Discrepancy (PMD) from a Peptide Spectrum Match (PSM) report.  

The PSM report must be from PeptideShaker (--input_file_type PSM_Report), 
or otherwise (--input_file_type PMD_FDR_input_file) have columns with header names:

  - PMD_FDR_input_score
  - PMD_FDR_pmd
  - PMD_FDR_spectrum_file
  - PMD_FDR_proteins
  - PMD_FDR_spectrum_title
  - PMD_FDR_sequence
  - PMD_FDR_decoy


PMD_FDR_package_for_Galaxy.R

usage: PMD_FDR_package_for_Galaxy.R [--] [--help] [--opts OPTS] [--psm_report PSM_REPORT] [--psm_report_1_percent PSM_REPORT_1_PERCENT] [--output_i_fdr OUTPUT_I_FDR] [--output_g_fdr OUTPUT_G_FDR] [--output_densities OUTPUT_DENSITIES] [--score_field_name SCORE_FIELD_NAME] [--input_file_type INPUT_FILE_TYPE]

arguments:
  -p, --psm_report PSM_REPORT            full name and path to the PSM report
  --psm_report_1_percent PSM_REPORT_1_PERCENT            full name and path to the PSM report for 1% FDR [default: ]
  -i, --input_file_type INPUT_FILE_TYPE            type of input file (currently supports: PSM_Report) [default: PMD_FDR_input_file]
  -o, --output_i_fdr OUTPUT_I_FDR            full name and path to the i-FDR output file  [default: ]
  --output_g_fdr OUTPUT_G_FDR            full name and path to the g-FDR output file  [default: ]
  --output_densities OUTPUT_DENSITIES            full name and path to the densities output file  [default: ]

    ]]></help>
</tool>
