<tool id="dialignr" name="DIAlignR" version="@WRAPPER_VERSION@">
    <description>for retention time alignment of targeted mass spectrometric data</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">bioconductor-dialignr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
    #import re

    mkdir -p ./data/mzml &&
    mkdir -p ./data/osw &&

    #for $mzml in $input_mzml_files:
        #set $file_name_mzml = re.sub('[^\w\-_.]', '_', str($mzml.element_identifier))
        echo '$file_name_mzml' >> ./runs.txt &&
        ln -s '$mzml' './data/mzml/${file_name_mzml}.chrom.mzML' &&
    #end for

    ln -s '$input_osw_file' './data/osw/merged.osw' &&

    Rscript --vanilla '${__tool_directory__}/dialignr.R' `pwd` &&

    cat alignedTargetedRuns.csv | sed 's/,/\t/g' > alignedTargetedRuns.tsv
    ]]></command>
    <inputs>
        <param name="input_mzml_files" type="data" format="mzml" multiple="true" label="MZML file(s)" help="Sample file(s) in .MZML format." />
        <param name="input_osw_file" type="data" format="osw" multiple="false" label="OSW file" help="Sample file in .OSW format." />
    </inputs>
    <outputs>
        <data name="out_aligned_targeted_runs" format="tsv" label="${tool.name} on ${on_string}: alignedTargetedRuns.tsv" from_work_dir="alignedTargetedRuns.tsv" />
    </outputs>
    <tests>
        <test>
            <param name="input_mzml_files" ftype="mzml" value="hroest_K120809_Strep0_PlasmaBiolRepl2_R04_SW_filt,hroest_K120809_Strep10_PlasmaBiolRepl2_R04_SW_filt" />
            <param name="input_osw_file" ftype="osw" value="merged.osw" />
            <output name="out_aligned_targeted_runs" file="alignedTargetedRuns.tsv" />
        </test>
    </tests>
    <help><![CDATA[
DIAlignR
=============

DIAlignR is an R package for retention time alignment of targeted mass spectrometric data, including DIA and SWATH-MS data. This tool works with MS2 chromatograms directly and uses dynamic programming for alignment of raw chromatographic traces. DIAlignR uses a hybrid approach of global (feature-based) and local (raw data-based) alignment to establish correspondence between peaks.

For more information see the DIAlignR documentation_.

.. _documentation: https://github.com/shubham1637/DIAlignR

    ]]></help>
     <citations>
         <citation type="doi">10.1074/mcp.TIR118.001132</citation>
    </citations>
</tool>