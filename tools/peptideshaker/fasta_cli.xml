<tool id="fasta_cli" name="FastaCLI" version="1.0">
    <description>
        Appends decoy sequences to FASTA files
    </description>
    <macros>
        <import>macros_basic.xml</import>
    </macros>
    <requirements>
	<requirement type="package" version="@SEARCHGUI_VERSION@">searchgui</requirement>
	<requirement type="package" version="3.0">zip</requirement>
    </requirements>
    <expand macro="stdio" />
    <command>
<![CDATA[
        #set $bin_dir = "bin"

        mkdir output;
        cwd=`pwd`;

        echo 'DB: ${input_database.display_name} sequences: ${input_database.metadata.sequences}';

        cp '${input_database}' input_database.fasta;

        ###########################################
        ####       Creating decoy database     ####
        ###########################################

        echo 'Creating decoy database.';
        searchgui eu.isas.searchgui.cmd.FastaCLI --exec_dir='./bin/' -temp_folder `pwd` -in input_database.fasta -decoy &&
        rm input_database.fasta;
        echo 'Decoy database:';
        echo '\$cwd/input_database_concatenated_target_decoy.fasta';
        echo "new fasta";
        echo './input_database_concatenated_target_decoy.fasta';

        exit_code_for_galaxy=\$?;
        (exit \$exit_code_for_galaxy)
]]>
    </command>
    <inputs>
        <param format="fasta" name="input_database" type="data" label="Protein Database"
            help="Select FASTA database from history"/>
    </inputs>
    <outputs>
        <data name="input_database_concatenated_target_decoy" format="fasta" from_work_dir="input_database_concatenated_target_decoy.fasta" label="${tool.name}: FASTA file with decoys on ${on_string}" />
    </outputs>
    <tests>
        <test>
            <param name="input_database" value="searchgui_tinydb1.fasta" ftype="fasta"/>
            <output name="input_database_concatenated_target_decoy" file="searchgui_tinydb1_concatenated_target_decoy.fasta" ftype="fasta" compare="sim_size" delta="1000" />
        </test>
    </tests>
    <help>
**What it does**

Appends decoy sequences to FASTA files adding to the accessions (as a suffix) "_REVERSED".
This format is adequated to be used by SearchGUI and PeptideShaker tools.
    </help>
    <expand macro="citations" />
</tool>
