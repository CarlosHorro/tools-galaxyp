<macros>
    <token name="@VERSION@">0.99.4a0</token>
    <token name="@GVERSION@">0.99.4a00</token>
    <xml name="requirements">
        <requirements>
        <requirement type="package" version="@VERSION@">metaquantome</requirement>
            <yield/>
        </requirements>
    </xml>
    <token name="@MAKE_SAMPS_TSV@"><![CDATA[
        ### make samps config file
        #if $samps_args.samps_src == 'history':
            cat '$samps_args.samps_file' > samp_file.tab &&
        #else:
            #set $samp_header = 'group\tcolnames'
            echo -e '${samp_header}' > samp_file.tab &&
            #for $s in $samps_args.samps
                #set $sample = str($s.group_name) + '\t' + str($s.col_names)
                echo -e '${sample}' >> samp_file.tab &&
            #end for
        #end if
    ]]>
    </token>
    <xml name="db">
      <param argument="db_tar" type="data" label="Database Archive File"/>
    </xml>
    <token name="@COMMON_PARAMS@"><![CDATA[
            --samps samp_file.tab
            --mode '$mode_args.mode'
            #if $mode_args.mode == 'f'
                --ontology='$mode_args.ontology_args.ontology'
                #if $mode_args.ontology_args.ontology == 'go'
                    #if $mode_args.ontology_args.slim_down
                        --slim_down
                    #end if
                #end if
            #end if
            #if $mode_args.mode == 'ft'
                --ontology='$mode_args.ontology_args.ontology'
                #if $mode_args.ontology_args.ontology == 'go'
                    #if $mode_args.ontology_args.slim_down
                        --slim_down
                    #end if
                #end if
            #end if
    ]]>
    </token>
    <xml name="SAMPS">
      <param name="samps" type="data" format="tabular" label="Samples file"
        help="must be created by 'metaQuantome: create samples file'"/>
    </xml>
    <xml name="common_params">
        <conditional name="mode_args">
            <param argument="--mode" type="select" label="Mode">
                <option value="f">Functional analysis</option>
                <option value="t">Taxonomic analysis</option>
                <option value="ft">Functional-taxonomic interaction analysis</option>
            </param>
            <when value="f">
                <expand macro="ONTOLOGY_ARGS"/>
            </when>
            <when value="t">
            </when>
            <when value="ft">
                <expand macro="ONTOLOGY_ARGS"/>
            </when>
        </conditional>
        <expand macro="SAMPS"/>
    </xml>
    <xml name="output_samples_choice">
        <param name="output_samps" type="boolean" truevalue="yes" falsevalue="no" checked="false" label="Output the samples fiile"/>
    </xml>
    <xml name="output_samples">
        <data format="tabular" name="samples_file" label="${tool.name} on ${on_string} samples" from_work_dir="samp_file.tab">
            <filter>output_samps == True</filter>
        </data>
    </xml>
    <xml name="citations">
        <citations>
            <yield />
        </citations>
    </xml>
</macros>
