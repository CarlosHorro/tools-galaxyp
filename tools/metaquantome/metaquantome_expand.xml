<tool id="metaquantome_expand" name="metaQuantome: expand" version="@VERSION@.0">
    <description>annotated functional or taxonomy terms to include all terms</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir -p data && #slurp
        @MAKE_SAMPS_TSV@
        metaquantome expand
        @EXPAND_PARAMS@
        @DB_DIR@
        #if $input.input_type == 'nopep':
            --nopep --nopep_file='$input.nopep_file'
        #else:
            --int_file='$input.int_file'
            --pep_colname_int='$input.pep_colname_int'
        #end if
       --outfile='$outfile'
    ]]></command>
    <inputs>
        <expand macro="data_dir"/>
        <expand macro="expand_params"/>
        <conditional name="input">
            <param name="input_type" type="select" label="Select input data">
                <option value="int">tabular intensity file with peptide column</option>
                <option value="nopep">file without a peptide column</option>
            </param>
            <when value="int">
                <param argument="--int_file" type="data" format="tabular" label="intensity data"
                    help=""/>
                <param argument="--pep_colname_int" type="text" value="" label="Peptide column name"
                    help="The column name within the intensity file that corresponds to the peptide sequences">
                    <validator type="empty_field"/>
                </param>
            </when>
            <when value="nopep">
                <param argument="--nopep_file" type="data" format="tabular" label="intensity data"
                    help=""/>
            </when>
        </conditional>
        <expand macro="output_samples_choice"/>
    </inputs>
    <outputs>
        <data format="tabular" name="outfile" label="${tool.name} on ${on_string} expanded"/>
        <expand macro="output_samples"/>
    </outputs>
    <tests>
        <test>
             <param name="int_file" value="int_ttest.tab" ftype="tabular"/>
             <param name="pep_colname_int" value="peptide" />
             <param name="func_file" value="multiple_func.tab" />
             <param name="pep_colname_func" value="peptide" />
             <param name="func_colname" value="go"/>
             <param name="mode" value="f" />
             <param name="ontology" value="go" />
             <param name="samps_src" value="build" />
             <repeat name="samps">
                 <param name="group_name" value="s1"/>
                 <param name="col_names" value="int1,int2,int3"/>
             </repeat>
             <repeat name="samps">
                 <param name="group_name" value="s2"/>
                 <param name="col_names" value="int4,int5,int6"/>
             </repeat>
             <output name="outfile" file="go_expanded.tab" ftype="tabular"/>
        </test>
    </tests>
    <help><![CDATA[
metaQuantome expand
===================

The *expand* module is the first step in the metaQuantome analysis workflow,
and can be run to analyze function, taxonomy, or function and taxonomy together.

See the figure below for an overview of the metaQuantome workflow:

.. image:: metaquantome_program_structure.png
   :width: 100 %

**metaQuantome workflow**: (A) Outline of metaQuantome program structure, (B) expanding the hierarchy, (C) and the definition of the total term abundance.


The following information is required for all 4 analysis modes:

- experimental design information
- a tab-separated peptide intensity file
- the name of the peptide column in the intensity file

Function mode
-------------

In function mode, the following information is required:

- the ontology being used: Gene Ontology (go), Clusters of Orthologous Groups (COG), or Enzyme Commission (EC) numbers.
- a tab-separated functional annotation file, with a peptide column and a functional annotation column. An entry in the functional annotation column may contain multiple functional annotations separated by a comma.
- the name of the peptide column in the functional annotation file
- the name of the functional annotation column in the functional annotation file

Taxonomy mode
-------------

In taxonomy mode, the following information is required:

- a tab-separated taxonomy annotation file, with a peptide column and a taxonomy annotation column. The taxonomic annotations should be the lowest common ancestor (LCA) for each peptide, preferably given as NCBI taxonomy IDs.
- the name of the peptide column in the taxonomic annotation file
- the name of the taxonomy annotation column in the taxonomy annotation file

Function-Taxonomy mode
----------------------

In the combined mode, all of the above must be provided. In addition, the "target rank" must be provided, which is the desired taxonomic rank at which to summarize the function/taxonomy results.

Databases
---------

Currently, metaQuantome on Galaxy is only set up to use automatically downloaded databases, so your results may change slightly from run to run. In the future, we plan to enable cached databases in Galaxy.

Questions, Comments, Problems, Kudos
------------------------------------

Please file any issues at https://github.com/galaxyproteomics/tools-galaxyp/issues.
    ]]></help>
    <expand macro="citations" />
</tool>
