<tool id="metaquantome_viz" name="MetaQuantome Visualization Plots" version="@VERSION@.0">
    <macros>
        <import>macros.xml</import>
        <xml name="img_size">
            <param argument="--height" type="float" value="" optional="true" label="Image height in inches"/>       
            <param argument="--width" type="float" value="" optional="true" label="Image width in inches"/>       
        </xml>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        @MAKE_SAMPS_TSV@
        metaquantome viz
        @COMMON_PARAMS@
        --infile='$infile'
        --plottype=$plot.plottype
        #if $plot.plottype == 'bar':
            --meancol='$plot.meancol'
            --nterms=$plot.nterms
            --barcolor=$plot.barcolor
        #elif $plot.plottype == 'volcano':
            --fc='$plot.fc'
            #if $plot.textannot:
                --textannot='$plot.textannot'
            #end if
            $plot.gosplit
        #elif $plot.plottype == 'heatmap':
            $plot.filter_to_sig
            --alpha=$plot.alpha
        #elif $plot.plottype == 'pca':
            $plot.calculate_sep
        #end if
        #if $plot.height:
            --height=$plot.height
        #end if
        #if $plot.width1:
            --width=$plot.width
        #end if
        --img='outfile.png'
    ]]></command>
    <inputs>
        <expand macro="common_params"/>
        <param argument="--infile" type="data" format="tabular" label="metaquantome stats or filtered file"
                    help=""/>
        <conditional name="plot">
            <param argument="--plottype" type="select" label="Plot type">
                <option value="bar">Bar Chart</option>
                <option value="volcano">Volcano Plot</option>
                <option value="heatmap">Heatmap</option>
                <option value="pca">PCA - Principal Componets Analysis</option>
            </param>
            <when value="bar">
                <param argument="--meancol" type="text" label="Mean intensity column name"
                        help="Mean intensity column name for desired experimental condition">
                        <validator type="empty_field"/>
                </param>
                <param argument="--nterms" type="integer" value="5" min="1" label="Number of taxa or functional terms to display"/>
                <param argument="--barcolor" type="integer" value="5" min="1" max="6" label="Color for the bar fill">
                    <help>
                        The color vector in R is
                        c("dodgerblue", "darkorange", "yellow2", "red2", "darkviolet", "black"), 
                        so providing a 1 will give the "dodgerblue" color. 
                        These same colors are also used in the heatmap and PCA plot, 
                        so the colors can be tweaked to match.
                    </help>
                </param>
                <expand macro="img_size"/>
            </when>
            <when value="volcano">
                <param argument="--fc" type="text" label="Name of the fold change column in the stat dataframe">
                        <validator type="empty_field"/>
                </param>
                <param argument="--textannot" type="text" optional="true" label="Name of the annotation column" 
                    help="Provides text annoatation for the plot.  Optional, if missing, no text will be plotted."/>
                <param argument="--gosplit" type="boolean" truevalue="--gosplit" falsevalue="" checked="false" 
                    label="Make one plot for each of BiologicalProcess, CellularComponent, and MolecularFuncion"/>
                <expand macro="img_size"/>
            </when>
            <when value="heatmap">
                <param argument="--filter_to_sig" type="boolean" truevalue="--filter_to_sig" falsevalue="" checked="false" 
                    label="Only plot significant term" help="Necessitates use of results from `test`"/>
                <param argument="--aplha" type="float" value="0.05" min="0.0" max="1.0" label="If filter_to_sig, the q-value significance level"/>
                <expand macro="img_size"/>
            </when>
            <when value="pca">
                <param argument="--calculate_sep" type="boolean" truevalue="--calculate_sep" falsevalue="" checked="false" 
                    label="Calculate separation between groups and include in title"/>
                <expand macro="img_size"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format="png" name="outfile" label="${tool.name} on ${on_string} stats" from_work_dir="outfile.png"/>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <expand macro="citations" />
</tool>
