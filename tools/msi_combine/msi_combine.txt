<tool id="mass_spectrometry_imaging_combine" name="MSI combine" version="1.7.0.1">
    <description>
        mass spectrometry imaging preprocessing
    </description>
    <requirements>
        <requirement type="package" version="1.7.0">bioconductor-cardinal</requirement>
    </requirements>
    <command detect_errors="exit_code">
    <![CDATA[

        #if $infile.ext == 'imzml'
            cp '${infile.extra_files_path}/imzml' infile.imzML &&
            cp '${infile.extra_files_path}/ibd' infile.ibd &&
        #elif $infile.ext == 'analyze75'
            cp '${infile.extra_files_path}/hdr' infile.hdr &&
            cp '${infile.extra_files_path}/img' infile.img &&
            cp '${infile.extra_files_path}/t2m' infile.t2m &&
        #else
            ln -s '$infile' infile.RData &&
        #end if
        cat '${cardinal_preprocessing}' &&
        Rscript '${cardinal_preprocessing}'

    ]]>
    </command>
    <configfiles>
        <configfile name="cardinal_preprocessing"><![CDATA[
library(Cardinal)

#if $infile.ext == 'imzml'
    msidata <- readMSIData('infile.imzML')
#elif $infile.ext == 'analyze75'
    msidata <- readMSIData('infile.hdr')
#else
    load('infile.RData')
#end if

# namen umbenennen vor combine, dann combine, dann output als RData, evtl. mz vektor ausgeben? 

# eigentlich kann man filtering tool für cut nehmen und binning/resampling tool danach, dann bleibt nur noch combine :) 
# könnte man dann auch verwenden um alle preprocessierten files zu combinieren...und dann QC? 
# was passiert wenn man combined hat und dann die tools die es gibt anwendet? e.g. QC, preproc, images, plots, segmentation -> mit MF_combi RData ausprobieren! 
